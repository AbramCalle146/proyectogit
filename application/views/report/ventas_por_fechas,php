<!-- Header -->
<div class="header bg-primary pb-6">
  <div class="container-fluid">
    <div class="header-body">
      <div class="row align-items-center py-4">
        <div class="col-lg-6 col-7">
          <h6 class="h2 text-white d-inline-block mb-0">Ventas por Fechas</h6>
          <nav aria-label="breadcrumb" class="d-none d-md-inline-block ml-md-4">
            <ol class="breadcrumb breadcrumb-links breadcrumb-dark">
              <li class="breadcrumb-item"><a href="<?php echo base_url(); ?>"><i class="fas fa-home"></i></a></li>
              <li class="breadcrumb-item"><a href="<?php echo base_url(); ?>report">Reportes</a></li>
              <li class="breadcrumb-item active">Ventas por Fechas</li>
            </ol>
          </nav>
        </div>
        <div class="col-lg-6 col-5 text-right">
          <a id="print" class="btn btn-secondary text-default">Imprimir</a>
          <a href="<?php echo base_url(); ?>report" class="btn btn-secondary text-default">Volver</a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Page content -->
<div class="container-fluid mt--6">
  <div class="row">
    <div class="col-xl-12 col-auto">
      <div class="card">
        <div class="card-header border-0" style="background-color: transparent;">
          <h3 class="mb-0" style="font-size: 2rem; color: white;">Reporte de ventas por fechas</h3>
        </div>

        <div class="card-body">
          <!-- Formulario para buscar por rango de fechas -->
          <form action="<?php echo base_url('report/ventasPorFechas'); ?>" method="GET">
              <div class="row">
                  <div class="col-md-4">
                      <label for="fecha_inicio">Fecha de Inicio:</label>
                      <input type="date" class="form-control" id="fecha_inicio" name="fecha_inicio" 
                             value="<?php echo isset($_GET['fecha_inicio']) ? htmlspecialchars($_GET['fecha_inicio']) : ''; ?>" required>
                  </div>
                  <div class="col-md-4">
                      <label for="fecha_fin">Fecha de Fin:</label>
                      <input type="date" class="form-control" id="fecha_fin" name="fecha_fin" 
                             value="<?php echo isset($_GET['fecha_fin']) ? htmlspecialchars($_GET['fecha_fin']) : ''; ?>" required>
                  </div>
                  <div class="col-md-4 align-self-end">
                      <button type="submit" class="btn btn-primary">Buscar</button>
                  </div>
              </div>
          </form>
          
          <!-- Mensaje de rango de fechas -->
          <?php if (isset($_GET['fecha_inicio']) && isset($_GET['fecha_fin'])): ?>
              <div class="alert alert-info mt-3">
                  Estas son las ventas desde <strong><?php echo htmlspecialchars($_GET['fecha_inicio']); ?></strong> hasta <strong><?php echo htmlspecialchars($_GET['fecha_fin']); ?></strong>.
              </div>
          <?php endif; ?>
          
          <!-- Tabla con los resultados -->
          <div class="table-responsive mt-4">
            <table id="salesTable" class="table align-items-center table-flush">
              <thead class="thead-light">
                <tr>
                  <th scope="col" class="sort">N°</th>
                  <th scope="col" class="sort">Cliente</th>
                  <th scope="col" class="sort">Producto</th>
                  <th scope="col" class="sort">Fecha</th>
                  <th scope="col" class="sort">Cantidad de Productos</th>
                  <th scope="col" class="sort">Total Ventas</th>
                </tr>
              </thead>
              <tbody class="list">
                <?php if (!empty($ventas)): ?>
                  <?php $number = 1; foreach ($ventas as $venta): ?>
                    <tr>
                      <td><?php echo $number++; ?></td>
                      <td><?php echo $venta->cliente; ?></td>
                      <td><?php echo $venta->producto; ?></td>
                      <td><?php echo date("Y-m-d", strtotime($venta->fecha)); ?></td>
                      <td><?php echo $venta->cantidad_productos; ?></td>
                      <td><?php echo number_format($venta->total_venta, 2); ?></td>
                    </tr>
                  <?php endforeach; ?>
                <?php else: ?>
                  <tr>
                    <td colspan="6">No hay datos disponibles.</td>
                  </tr>
                <?php endif; ?>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- After the Sales Table -->
<div class="card mt-4" style="max-width: 1200px; margin: auto;"> <!-- Ajuste de tamaño intermedio -->
  <div class="card-header"style="background-color: transparent;">
    <h5 class="mb-0"style="font-size: 1.5rem; color: white;">Gráfico de Ventas por Fechas</h5>
  </div>
  <div class="card-body">
    <canvas id="salesChart" style="height: 500px;"></canvas> <!-- Ajustar altura -->
  </div>
</div>
// Include Chart.js library
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// Prepare the data for the chart
var labels = []; // Array to hold the dates
var salesData = []; // Array to hold the total sales for each date

<?php if (!empty($ventas)): ?>
  <?php foreach ($ventas as $venta): ?>
    labels.push('<?php echo date("Y-m-d", strtotime($venta->fecha)); ?>');
    salesData.push(<?php echo number_format($venta->total_venta, 2, '.', ''); ?>); // Ensure it's a number
  <?php endforeach; ?>
<?php endif; ?>

// Get the context of the canvas element
var ctx = document.getElementById('salesChart').getContext('2d');

// Create the chart
var salesChart = new Chart(ctx, {
    type: 'line', // Change to 'bar' or other types as needed
    data: {
        labels: labels,
        datasets: [{
            label: 'Total Ventas',
            data: salesData,
            borderColor: 'rgba(75, 192, 192, 1)',
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            borderWidth: 2,
            fill: true // Fill the area under the line
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: {
                beginAtZero: true,
                title: {
                    display: true,
                    text: 'Total Ventas',
                    color: 'white' // Cambiar el color del título del eje Y a blanco
                },
                ticks: {
                    color: 'white' // Cambiar el color de los ticks del eje Y a blanco
                }
            },
            x: {
                title: {
                    display: true,
                    text: 'Fechas',
                    color: 'white' // Cambiar el color del título del eje X a blanco
                },
                ticks: {
                    color: 'white' // Cambiar el color de los ticks del eje X a blanco
                }
            }
        },
        plugins: {
            legend: {
                labels: {
                    color: 'white' // Cambiar el color de las etiquetas de la leyenda a blanco
                }
            }
        }
    }
});
</script>

